[project]
name = "Synaptipy"
version = "0.1.0"
description = "Electrophysiology Visualization Suite"
requires-python = ">=3.9"

# ==============================================================================
# CROSS-PLATFORM DEPENDENCY MANAGEMENT
# ==============================================================================
# 
# This project automatically creates the complete environment during pip install
# ALL packages are installed with EXACT versions from working synaptipy environment
# 
# CRITICAL: pip install -e . automatically handles everything!
# This ensures Qt6 system libraries are properly installed via conda
# 
# CROSS-PLATFORM APPROACH:
# - Single environment.yml handles Windows, macOS, and Linux automatically
# - Conda automatically installs OS-specific packages (ucrt, libcxx, libstdcxx-ng, etc.)
# - No OS-specific dependencies in pyproject.toml or setup.py
# - Everything works on all platforms without modification
# 
# The setup.py automatically detects the OS and handles environment creation
# while preserving source locks and versions across all platforms.
dependencies = [
    "numpy>=2.0.2",
    # --- GUI and Plotting ---
    # CRITICAL: PySide6 is NOT installed via pip - it comes from conda environment
    # Installing via pip causes Qt binary compatibility issues and plotting failures
    # The setup automatically creates the complete environment during installation
    "pyqtgraph>=0.13.7",
    # --- Core/Infra ---
    "neo>=0.14.2",
    "scipy>=1.13.1",
    # --- Export ---
    "pynwb>=3.1.2",
    "tzlocal>=5.3.1", # Recommended for timezone handling in NWB
    # --- Data Processing ---
    "h5py>=3.14.0",
    "hdmf>=4.1.0",
    "jsonschema>=4.25.1",
    "quantities>=0.16.2",
    "referencing>=0.36.0",
    "pandas>=2.3.1",
]

# ==============================================================================
# AUTOMATIC INSTALLATION FEATURES
# ==============================================================================
# 
# ✅ ONE-COMMAND INSTALLATION: pip install -e .
# ✅ AUTOMATIC ENVIRONMENT CREATION from single environment.yml
# ✅ EXACT VERSION REPLICATION from working synaptipy environment
# ✅ CROSS-PLATFORM SUPPORT (Windows, macOS, Linux)
# ✅ INTELLIGENT DEPENDENCY RESOLUTION
# ✅ OS-SPECIFIC PACKAGE HANDLING (automatic via conda)
#
# The setup automatically:
# 1. Creates synaptipy environment from environment.yml
# 2. Conda automatically handles OS-specific packages (ucrt, libcxx, libstdcxx-ng, etc.)
# 3. Installs Qt6 system libraries via conda with EXACT versions (6.7.3)
# 4. Installs PySide6 via conda to match Qt6 (binary compatibility)
# 5. Installs Python packages via pip with EXACT versions
# 6. Ensures PySide6 versions match Qt system libraries exactly
# 7. Prevents Qt platform plugin and DLL loading issues
# 8. Preserves source locks and versions across all platforms
# 9. Works on Windows, macOS, and Linux without modification
#
# CRITICAL: Qt6 and PySide6 come from controlled sources for cross-platform compatibility
# This matches the working environment and prevents binary compatibility issues

[project.scripts]
synaptipy-gui = "Synaptipy.application.__main__:run_gui"

# ==============================================================================
# DEVELOPMENT AND OPTIONAL DEPENDENCIES
# ==============================================================================
[project.optional-dependencies]
dev = [
    # Testing
    "pytest>=7.0.0",
    "pytest-qt>=4.0.0",
    "pytest-mock",
    "pytest-cov",
    
    # Linting & Formatting
    "flake8",
    "black",
    "isort",
    
    # Building & Distribution
    "build",
    "twine",
    
    # Documentation
    "sphinx",
    "sphinx-rtd-theme",
]

# GUI-specific dependencies (PySide6 comes from conda environment)
gui = [
    "pyqtgraph>=0.13.7",
]

# Full installation with all dependencies (PySide6 comes from conda environment)
full = [
    "numpy>=2.0.2",
    "pyqtgraph>=0.13.7",
    "neo>=0.14.2",
    "scipy>=1.13.1",
    "pynwb>=3.1.2",
    "tzlocal>=5.3.1",
    "h5py>=3.14.0",
    "hdmf>=4.1.0",
    "jsonschema>=4.25.1",
    "quantities>=0.16.2",
    "referencing>=0.36.0",
    "pandas>=2.3.1",
]

# ==============================================================================
# BUILD SYSTEM
# ==============================================================================
[build-system]
requires = ["setuptools>=61.0", "wheel"]
build-backend = "setuptools.build_meta"

# ==============================================================================
# PROJECT METADATA
# ==============================================================================
[project.urls]
Homepage = "https://github.com/anzalks/synaptipy"
Repository = "https://github.com/anzalks/synaptipy"
Documentation = "https://github.com/anzalks/synaptipy/docs"
"Bug Tracker" = "https://github.com/anzalks/synaptipy/issues"

# ==============================================================================
# TOOL CONFIGURATION
# ==============================================================================
[tool.setuptools.packages.find]
where = ["src"]

[tool.setuptools.package-data]
"*" = ["*.yml", "*.yaml", "*.txt"]